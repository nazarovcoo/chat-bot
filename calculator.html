<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Калькулятор</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #1a1a2e;
      font-family: 'Segoe UI', sans-serif;
    }

    .calculator {
      background: #16213e;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      width: 320px;
    }

    .avatar {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }

    .avatar img {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #e94560;
      box-shadow: 0 0 0 3px #0f3460;
    }

    .display {
      background: #0f3460;
      border-radius: 12px;
      padding: 20px 16px 12px;
      margin-bottom: 20px;
      text-align: right;
      min-height: 90px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }

    .display .expression {
      color: #7a8fa6;
      font-size: 14px;
      min-height: 20px;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .display .result {
      color: #e0e0e0;
      font-size: 36px;
      font-weight: 300;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    /* Кнопки */
    button {
      border: none;
      border-radius: 12px;
      font-size: 18px;
      padding: 18px;
      cursor: pointer;
      font-weight: 500;
      position: relative;
      overflow: hidden;
      /* убираем стандартный transition, анимация через JS */
    }

    /* Желейная анимация */
    @keyframes jelly {
      0%   { transform: scale(1, 1); }
      15%  { transform: scale(0.82, 1.18); }
      30%  { transform: scale(1.18, 0.82); }
      45%  { transform: scale(0.9, 1.1); }
      60%  { transform: scale(1.08, 0.94); }
      75%  { transform: scale(0.97, 1.03); }
      90%  { transform: scale(1.02, 0.98); }
      100% { transform: scale(1, 1); }
    }

    button.jelly {
      animation: jelly 0.55s cubic-bezier(0.36, 0.07, 0.19, 0.97);
    }

    /* Рябь от клика */
    .ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple-expand 0.55s linear;
      background: rgba(255, 255, 255, 0.25);
      pointer-events: none;
    }

    @keyframes ripple-expand {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    .btn-number {
      background: #1a2a4a;
      color: #e0e0e0;
    }

    .btn-number:hover { background: #1e3256; }

    .btn-operator {
      background: #0f3460;
      color: #4fc3f7;
    }

    .btn-operator:hover { background: #1a4080; }

    .btn-equals {
      background: #e94560;
      color: #fff;
      grid-column: span 2;
    }

    .btn-equals:hover { background: #f05070; }

    .btn-clear {
      background: #7a1a2e;
      color: #ff8fa0;
    }

    .btn-clear:hover { background: #9a2040; }

    .btn-special {
      background: #0d2137;
      color: #80cbc4;
    }

    .btn-special:hover { background: #122a47; }

    .btn-zero {
      grid-column: span 2;
      text-align: left;
      padding-left: 26px;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="avatar">
      <img src="photo.jpg" alt="Фото">
    </div>
    <div class="display">
      <div class="expression" id="expression"></div>
      <div class="result" id="result">0</div>
    </div>
    <div class="buttons">
      <button class="btn-clear" onclick="clearAll()">AC</button>
      <button class="btn-special" onclick="toggleSign()">+/−</button>
      <button class="btn-special" onclick="percent()">%</button>
      <button class="btn-operator" onclick="setOperator('/')">÷</button>

      <button class="btn-number" onclick="append('7')">7</button>
      <button class="btn-number" onclick="append('8')">8</button>
      <button class="btn-number" onclick="append('9')">9</button>
      <button class="btn-operator" onclick="setOperator('*')">×</button>

      <button class="btn-number" onclick="append('4')">4</button>
      <button class="btn-number" onclick="append('5')">5</button>
      <button class="btn-number" onclick="append('6')">6</button>
      <button class="btn-operator" onclick="setOperator('-')">−</button>

      <button class="btn-number" onclick="append('1')">1</button>
      <button class="btn-number" onclick="append('2')">2</button>
      <button class="btn-number" onclick="append('3')">3</button>
      <button class="btn-operator" onclick="setOperator('+')">+</button>

      <button class="btn-number btn-zero" onclick="append('0')">0</button>
      <button class="btn-number" onclick="appendDot()">.</button>
      <button class="btn-equals" onclick="calculate()">=</button>
    </div>
  </div>

  <script>
    let current = '0';
    let previous = null;
    let operator = null;
    let resetNext = false;
    let expression = '';

    const resultEl = document.getElementById('result');
    const expressionEl = document.getElementById('expression');

    function updateDisplay() {
      resultEl.textContent = current;
      expressionEl.textContent = expression;
    }

    function append(digit) {
      if (resetNext) {
        current = digit;
        resetNext = false;
      } else {
        current = current === '0' ? digit : current + digit;
      }
      if (current.length > 12) current = current.slice(0, 12);
      updateDisplay();
    }

    function appendDot() {
      if (resetNext) { current = '0.'; resetNext = false; updateDisplay(); return; }
      if (!current.includes('.')) current += '.';
      updateDisplay();
    }

    function clearAll() {
      current = '0';
      previous = null;
      operator = null;
      resetNext = false;
      expression = '';
      updateDisplay();
    }

    function toggleSign() {
      current = String(parseFloat(current) * -1);
      updateDisplay();
    }

    function percent() {
      current = String(parseFloat(current) / 100);
      updateDisplay();
    }

    const opSymbols = { '+': '+', '-': '−', '*': '×', '/': '÷' };

    function setOperator(op) {
      if (operator && !resetNext) calculate(true);
      previous = parseFloat(current);
      operator = op;
      expression = current + ' ' + opSymbols[op];
      resetNext = true;
      updateDisplay();
    }

    function calculate(chain = false) {
      if (operator === null || previous === null) return;
      const curr = parseFloat(current);
      let res;
      switch (operator) {
        case '+': res = previous + curr; break;
        case '-': res = previous - curr; break;
        case '*': res = previous * curr; break;
        case '/': res = curr === 0 ? 'Ошибка' : previous / curr; break;
      }
      if (!chain) {
        expression = expression + ' ' + current + ' =';
      }
      current = res === 'Ошибка' ? 'Ошибка' : String(parseFloat(res.toFixed(10)));
      if (!chain) { operator = null; previous = null; }
      resetNext = true;
      updateDisplay();
    }

    /* --- Желейный эффект + рябь --- */
    document.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('click', function (e) {
        /* Рябь */
        const ripple = document.createElement('span');
        ripple.classList.add('ripple');
        const rect = btn.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        ripple.style.width = ripple.style.height = size + 'px';
        ripple.style.left = (e.clientX - rect.left - size / 2) + 'px';
        ripple.style.top  = (e.clientY - rect.top  - size / 2) + 'px';
        btn.appendChild(ripple);
        ripple.addEventListener('animationend', () => ripple.remove());

        /* Желе */
        btn.classList.remove('jelly');
        void btn.offsetWidth; /* reflow для перезапуска анимации */
        btn.classList.add('jelly');
        btn.addEventListener('animationend', () => btn.classList.remove('jelly'), { once: true });
      });
    });

    /* --- Клавиатура --- */
    document.addEventListener('keydown', e => {
      if (e.key >= '0' && e.key <= '9') append(e.key);
      else if (e.key === '.') appendDot();
      else if (e.key === '+') setOperator('+');
      else if (e.key === '-') setOperator('-');
      else if (e.key === '*') setOperator('*');
      else if (e.key === '/') { e.preventDefault(); setOperator('/'); }
      else if (e.key === 'Enter' || e.key === '=') calculate();
      else if (e.key === 'Escape') clearAll();
      else if (e.key === 'Backspace') {
        if (current.length > 1) current = current.slice(0, -1);
        else current = '0';
        updateDisplay();
      }
    });
  </script>
</body>
</html>
